// var callback = () => { if (window.innerWidth < 749) for (var e = document.getElementsByClassName("wk-split__cart__table"), t = 0; t < e.length; t++)for (var r = e[t].getElementsByTagName("tbody")[0].getElementsByTagName("tr"), a = 0; a < r.length; a++) { var n = r[a].getElementsByTagName("td"), o = n[4].cloneNode(!0); o.setAttribute("colspan", "1"), r[a].after(o); var i = n[3].cloneNode(!0); i.setAttribute("colspan", "2"), r[a].after(i), n[3].remove() } var s = document.getElementsByClassName("wk-buy"), c = jQuery.ajax({ url: "/cart.js", dataType: "json", cache: !1, success: () => { wkCartItems = c.responseJSON, "undefined" == typeof wkCartItems && (wkCartItems = c.responseText, wkCartItems = JSON.parse(wkCartItems)), items = wkCartItems.items; for (var e = 0; e < s.length; e++)s[e].onclick = function (e) { e.preventDefault(); var t = sessionStorage.getItem("WK_SHOPIFY_SPLIT_CART"); if ("" !== t && null !== t) { var r = this.getAttribute("data-params"), a = this.getAttribute("data-vendor"), n = a.split(" "), o = 0, i = 0; if (n = n.join("_"), $("*[id='route_insurance_" + n + "']").length) { var s = $("*[id='route_insurance_" + n + "']").attr("data-insurance_checked"); "true" != s && 1 != s || (i = $("*[id='insurance_price_" + n + "']").attr("data-price"), o = 1, draft_order_enabled = 1) } if ($(".wk_po_count").length && (draft_order_enabled = 1), 1 === draft_order_enabled || 1 == draft_order_enabled) { var c = {}; if (c.status = pickup_by_cart_enabled, 1 == pickup_by_cart_enabled) { var d = a + "attributes-store_pickup"; if (void 0 === $("input[name='" + d + "']:checked")) return !1; var _ = $("input[name='" + d + "']:checked").val(); if (c.is_pickup = _, "YES" == _) { var l = $("*[id='cart_pickup_" + n + "']"); if (void 0 !== l && l.val().length > 0) { l = (l = l.val()).split("//"), c.loc = l[1], c.locId = l[0], void 0 !== l[2] && (c.locName = l[2]); var p = []; items.forEach(async function (e) { if (e.vendor == a) { var t = {}; t[e.variant_id] = e.quantity, p.push(t) } }), jQuery.ajax({ url: server_name + "index.php?p=get_pickup_by_cart", dataType: "jsonp", type: "GET", contentType: "application/json", jsonpCallback: "validateCartLocations", data: { shop_name: Shopify.shop, varient_ids: p, cart_loc: l[0] }, success: function (e) { if ("true" !== $.trim(e)) { var t = "<div class='cart-pickup-error'>   <strong>" + e + "</strong> " + pickup_by_cart_error_message + "</div>"; return document.getElementById("wkCartLocError_" + n).innerHTML = t, $("wkCartLoc_" + vendor).css("background-color", "#ecb9b9"), $("button.wk-buy[data-vendor=" + a + "]").hide(), !1 } draftOrder(items, a, c, { order_insurance_enabled: o, order_insurance_price: i }) } }) } } else draftOrder(items, a, c, { order_insurance_enabled: o, order_insurance_price: i }) } else draftOrder(items, a, c, { order_insurance_enabled: o, order_insurance_price: i }) } else if ("undefined" != document.getElementsByClassName("wk_pay_what_you_want_count_split_cart") && document.getElementsByClassName("wk_pay_what_you_want_count_split_cart").length > 0) draftOrder(items, a, { status: 0 }, { order_insurance_enabled: o, order_insurance_price: i }); else { var u = $(this).parent().parent().parent().parent().children(".wk-order-note"); if (void 0 !== u.children("textarea") && u.children("textarea").length > 0) { var m = u.children("textarea")[0].value; void 0 !== m && "" != m && (r += "?note=" + encodeURIComponent(m)) } var v = !1; items.forEach(async function (e) { e.vendor == a && null != e.properties && e.properties.length > 0 && (e.properties.store_pickup, v = !0) }); var g = sessionStorage.getItem("WK_SHOPIFY_SPLIT_CART"); if (null !== g) { var f = (g = g.split("&*#*&")).indexOf(a); f > -1 && g.splice(f, 1) } v ? draftOrder(items, a, { status: 0 }, { order_insurance_enabled: o, order_insurance_price: i }) : (sessionStorage.removeItem(a), sessionStorage.setItem("WK_SHOPIFY_SPLIT_CART", g), window.location.href += "/" + r) } } } } }) }; function wkRemoveItem(e) { var t = {}, r = sessionStorage.getItem("WK_SHOPIFY_SPLIT_CART"), a = sessionStorage.getItem("order_note"); if (null !== a && "" !== a && sessionStorage.removeItem("order_note"), "" !== r && null !== r) { r = r.split(","); for (var n = 0; n < r.length; n++) { var o = document.getElementById("cartSpecialInstructions_" + r[n]); t[r[n]] = void 0 !== o && null != o ? o.value : "" } var i = JSON.stringify(t); sessionStorage.setItem("order_note", i) } sessionStorage.removeItem(e); var s = sessionStorage.getItem("WK_SHOPIFY_SPLIT_CART"); if (null !== s) { var c = (s = s.split(",")).indexOf(e); c > -1 && s.splice(c, 1), sessionStorage.setItem("WK_SHOPIFY_SPLIT_CART", s) } } function draftOrder(e, t, r, a) { let n = $(".wk_po_count").length, o = meta.page.customerId; if (n) { let e = "/account/login?checkout_url=" + document.location.href + "#wkpreorder"; if (void 0 === o) return window.open(e, "_top"), !1 } var i = "", s = document.getElementById("cartSpecialInstructions_" + t); if (void 0 !== s && null != s && s.value.length > 0 && (i = s.value), 1 == r.status) { var c = {}, d = []; c.store_pickup_by_cart = r.is_pickup, c.wk_loc_id = r.locId, d.push(c) } else d = !1; DELIVERY_SLOT_MANAGEMENT_ENABLED && (d = buildDSMAttributes(d, t)), cart_arr = []; var _ = 0; e.forEach(async function (e) { if (e.vendor == t) { var a = {}; if (a.title = e.variant_title, a.quantity = e.quantity, a.product_id = e.product_id, a.variant_id = e.variant_id, a.price = e.price, a.handle = e.handle, a.product_title = e.product_title, a.unit_discount = e.total_discount, 1 == r.status) if (null !== e.properties) "YES" == r.is_pickup ? (e.properties.store_pickup = "YES", e.properties.store_pickup_address = r.loc, void 0 !== r.locName && (e.properties.store_pickup_location_name = r.locName)) : e.properties.store_pickup = "NO"; else { var n = {}; "YES" == r.is_pickup ? (n.store_pickup = "YES", n.store_pickup_address = r.loc, void 0 !== r.locName && (n.store_pickup_location_name = r.locName)) : n.store_pickup = "NO", e.properties = n } a.properties = e.properties, a.note = i, a.requires_shipping = e.requires_shipping, cart_arr[_] = a, _++ } }), jQuery.ajax({ type: "POST", url: server_name + "index.php?p=ajax_product_properties", cache: !1, data: { callback: "getProductProperties", code: "new", shop_name: Shopify.shop, cart_details: cart_arr, cart_token: wkCartItems.token, note_attribute: d, wk_insurance_selected: a.order_insurance_enabled, wk_routes_insurance_price: a.order_insurance_price, wk_preorder_count: n, customer_id: meta.page.customerId, vendor: t }, success: function (e) { if (console.log(e), "req_qty_not_found" == e) { console.log("preorder error!!!"); var r = $("*[data-vendor='" + t + "']"); r.hide(); let e = SPL.$("<div class='wk_po_msg__div'><p style='color:red; word-wrap:break-word;' >" + wk_preorder_qty_error_label + "</p></div>"); r.after(e) } else "denied" != e && (sessionStorage.setItem("WK_DRAFT_VENDOR", t), window.location.href = e.invoice_url) }, dataType: "json" }) } const buildDSMAttributes = (e, t) => { null != e && Array.isArray(e) || (e = []); const r = document.querySelector(`.dsm-split-cart-widget[data-vendor="${t}"]`), a = {}; return r.querySelectorAll('input[type="hidden"][name*="attributes"]').forEach(e => a[e.name.substring(11, e.name.length - 1)] = e.value), e.push(a), e }; var script; "undefined" == typeof jQuery ? ((script = document.createElement("script")).type = "text/javascript", script.src = "//ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js", document.getElementsByTagName("head")[0].appendChild(script), "complete" === document.readyState || "loading" !== document.readyState && !document.documentElement.doScroll ? callback() : window.addEventListener("load", callback)) : callback();
